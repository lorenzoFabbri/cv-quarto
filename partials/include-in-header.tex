% Adapted from:
%  - https://github.com/schochastics/classic-cv
%  - https://github.com/mps9506/quarto-cv
%  - Assisting with GitHub Copilot

% --------------------------------------------------------------------
% Page geometry
% --------------------------------------------------------------------
\usepackage[a4paper]{geometry}
\geometry{top=10mm, bottom=20mm, left=10mm, right=10mm}

% --------------------------------------------------------------------
% XeLaTeX: fonts & language
% --------------------------------------------------------------------
\usepackage{fontspec}

\usepackage[british]{babel}
\usepackage{csquotes}

% --------------------------------------------------------------------
% Colours & hyperlinks
% --------------------------------------------------------------------
\usepackage[dvipsnames,usenames]{xcolor}
\usepackage{hyperref}
\hypersetup{
	unicode=true,
	colorlinks=true,
	linkcolor=$if(linkcolor)$$linkcolor$$else$Maroon$endif$,
	citecolor=$if(citecolor)$$citecolor$$else$blue$endif$,
	urlcolor=$if(urlcolor)$$urlcolor$$else$blue$endif$,
	breaklinks=true,
	bookmarks=true
}

\definecolor{bgcol}{RGB}{110, 110, 110}
\definecolor{softcol}{RGB}{225, 225, 225}

% --------------------------------------------------------------------
% Basic layout
% --------------------------------------------------------------------
% Explicit paragraph settings
\setlength{\parskip}{0pt}
\setlength{\parindent}{0pt}

% --------------------------------------------------------------------
% Verbatim, icons and misc
% --------------------------------------------------------------------
\usepackage{fancyvrb}
\VerbatimFootnotes
\usepackage{orcidlink}
\usepackage{academicons}
\usepackage{fontawesome5}

% --------------------------------------------------------------------
% Header/footer and date
% --------------------------------------------------------------------
\usepackage{datetime}
\usepackage{fancyhdr}
\usepackage{lastpage}
\pagestyle{fancy}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}
\lhead{}
\chead{}
\rhead{}
\lfoot{}
\rfoot{\scriptsize \raggedright Last revised: \today}

% --------------------------------------------------------------------
% Helpers: layout, tables, graphics, tikz
% --------------------------------------------------------------------
\usepackage{changepage}
\usepackage{moresize}
\usepackage{xifthen}
\usepackage{multicol}
\usepackage{multirow}
\usepackage{array}
\usepackage{graphicx}
\usepackage{wrapfig}
\usepackage{float}
\floatplacement{table}{H}

\usepackage{tikz}
\usetikzlibrary{shapes, backgrounds, mindmap, trees}

\usepackage[all,defaultlines=2]{nowidow}

% --------------------------------------------------------------------
% enumitem
% --------------------------------------------------------------------
\usepackage{enumitem}
\setlist[1]{labelindent=\parindent}
\setlist[itemize]{leftmargin=*}
\setlist[enumerate]{leftmargin=*}

% --------------------------------------------------------------------
% Bibliography
% --------------------------------------------------------------------
\usepackage{etoolbox}

% Explicitly load biblatex with options that mirror YAML
\usepackage[backend=biber,maxnames=99,sorting=ydnt,sortlocale=en-GB]{biblatex}

% Add the bibliography resource if it exists in the build folder
\IfFileExists{bibliography.bib}{\addbibresource{bibliography.bib}}{}

% Slightly reduce bibliography spacing
\setlength\bibitemsep{0pt}
\renewcommand*{\bibfont}{\small}
\setlength\bibhang{\parindent}

% --------------------------------------------------------------------
% Macros to make a selected name bold in bibliography entries
% --------------------------------------------------------------------
\def\makenamesetup{
	\def\bibnamedelima{~}
	\def\bibnamedelimb{ }
	\def\bibnamedelimc{ }
	\def\bibnamedelimd{ }
	\def\bibnamedelimi{ }
	\def\bibinitperiod{.}
	\def\bibinitdelim{~}
	\def\bibinithyphendelim{.-}
}
\newcommand*{\makename}[2]{\begingroup\makenamesetup\xdef#1{#2}\endgroup}
\newcommand*{\boldname}[3]{%
	\def\lastname{#1}%
	\def\firstname{#2}%
	\def\firstinit{#3}%
}
\renewcommand{\mkbibnamegiven}[1]{%
	\ifboolexpr{
		(test {\ifdefequal{\firstname}{\namepartgiven}} or
		test {\ifdefequal{\firstinit}{\namepartgiven}}) and
		test {\ifdefequal{\lastname}{\namepartfamily}}
		}{\mkbibbold{#1}}{#1}%
}
\renewcommand{\mkbibnamefamily}[1]{%
	\ifboolexpr{
		(test {\ifdefequal{\firstname}{\namepartgiven}} or
		test {\ifdefequal{\firstinit}{\namepartgiven}}) and
		test {\ifdefequal{\lastname}{\namepartfamily}}
		}{\mkbibbold{#1}}{#1}%
}

% --------------------------------------------------------------------
% Small helpers and column types
% --------------------------------------------------------------------
\newlength{\spacebox}
\settowidth{\spacebox}{123456789}
\newcommand{\sepspace}{\vspace*{1em}}

\newcolumntype{x}[1]{>{\raggedleft\hspace{0pt}}p{#1}}

% Hide section numbering (CV style)
\renewcommand{\thesection}{}

% --------------------------------------------------------------------
% Section / meta-section commands
% --------------------------------------------------------------------
\newcommand{\cvsection}[1]{%
	\begin{center}
		\large{\textbf{#1}}
	\end{center}%
}

\newcommand{\metasection}[2]{%
	\footnotesize{#2} \hspace*{\fill} \footnotesize{#1}\\[1pt]%
}

% --------------------------------------------------------------------
% CV event macros
% - 4th parameter (#4) is raw LaTeX content (itemize/paragraphs) for reliability
% --------------------------------------------------------------------
\newcommand{\cvevent}[4]{%
	\begin{tabular*}{1\textwidth}{p{13.6cm}x{3.9cm}}
		\textbf{#2}\\
		\textcolor{bgcol}{#3} & \vspace{2.5pt}\textcolor{bgcol}{#1}
	\end{tabular*}%
	\vspace{-2pt}%
	\textcolor{softcol}{\hrule}%
	\vspace{6pt}%
	\begin{adjustwidth}{2.5em}{0pt}%
		#4%
	\end{adjustwidth}%
	\vspace{3pt}%
}

\newcommand{\cvshortevent}[3]{%
	\begin{tabular*}{1\textwidth}{p{13.6cm}x{3.9cm}}
		\textbf{#2}\\
		\textcolor{bgcol}{#3} & \vspace{2.5pt}\textcolor{bgcol}{#1}
	\end{tabular*}%
	\vspace{3pt}%
}
